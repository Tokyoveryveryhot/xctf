常用基本的格式化字符串参数介绍：
%c：输出字符，配上%n可用于向指定地址写数据。

%d：输出十进制整数，配上%n可用于向指定地址写数据。

%x：输出16进制数据，如%i$x表示要泄漏偏移i处4字节长的16进制数据，%i$lx表示要泄漏偏移i处8字节长的16进制数据，32bit和64bit环境下一样。

%p：输出16进制数据，与%x基本一样，只是附加了前缀0x，在32bit下输出4字节，在64bit下输出8字节，可通过输出字节的长度来判断目标环境是32bit还是64bit。

%s：输出的内容是字符串，即将偏移处指针指向的字符串输出，如%i$s表示输出偏移i处地址所指向的字符串，在32bit和64bit环境下一样，可用于读取GOT表等信息。

%n：将%n之前printf已经打印的字符个数赋值给偏移处指针所指向的地址位置，如%100×10$n表示将0x64写入偏移10处保存的指针所指向的地址（4字节），而%$hn表示写入的地址空间为2字节，%$hhn表示写入的地址空间为1字节，%$lln表示写入的地址空间为8字节，在32bit和64bit环境下一样。有时，直接写4字节会导致程序崩溃或等候时间过长，可以通过%$hn或%$hhn来适时调整。
%n - 到目前为止所写的字符数。其功能是将%n之前打印出来的字符个数，赋值给一个变量。
例子：#include<cstdio>
int main(int argc,char const *argv[])
{
    int a=0;
    printf("Hello world%n",&a);
    printf("%d\n",a);
    return 0;
}
输出：Hello world 11

%n是通过格式化字符串漏洞改变程序流程的关键方式，而其他格式化字符串参数可用于读取信息或配合%n写数据。


格式化字符串漏洞的原理
格式化字符串函数可以接受可变数量的参数，并将第一个参数作为格式化字符串，根据其来解析之后的参数。通俗来说，格式化字符串函数就是将计算机内存中表示的数据转化为我们人类可读的字符串格式。几乎所有的 C/C++ 程序都会利用格式化字符串函数来输出信息，调试程序，或者处理字符串。一般来说，格式化字符串在利用的时候主要分为三个部分

格式化字符串函数
格式化字符串
后续参数，可选

给出一个简单的例子：
printf("Color %s,Number %d,Float %4,2f","red",123456,3.14)
在进入printf函数前（未调用printf），栈上的布局由高地址到低地址依次是：

some valude
3.14
123456
addr of "red"
addr of format string:Color %s...

在进入 printf 之后，函数首先获取第一个参数，一个一个读取其字符会遇到两种情况

当前字符不是 %，直接输出到相应标准输出。
当前字符是 %， 继续读取下一个字符
如果没有字符，报错
如果下一个字符是 %, 输出 %
否则根据相应的字符，获取相应的参数，对其进行解析并输出
那么假设，此时我们在编写程序时候，写成了下面的样子

printf(“Color %s, Number %d, Float %4.2f”);
此时我们可以发现我们并没有提供参数，那么程序会如何运行呢？程序照样会运行，会将栈上存储格式化字符串地址上面的三个变量分别解析为

解析其地址对应的字符串
解析其内容对应的整形值
解析其内容对应的浮点值
对于 2，3 来说倒还无妨，但是对于对于 1 来说，如果提供了一个不可访问地址，比如 0，那么程序就会因此而崩溃。

什么是格式化字符串漏洞？
会触发该漏洞的函数很有限，主要就是printf、sprintf、fprintf等print家族函数，以printf函数为例：
printf()函数的一般形式为printf("format", 输出表列)，其第一个参数就是格式化字符串，用来告诉程序以什么格式进行输出。正常情况下，我们是这样使用的：
char str[100];
scanf("%s",str);printf("%s",str);
但也会有人这么用：
char str[100];scanf("%s",str);
printf(str)
上述代码的本意都是希望输入一段字符并且打印出来（e.g.“helloworld”）但是二种写法使得打印的结果被终端输入者控制，而不是程序本身。如果输入的内容中包含%s，%d，%f这样的内容，printf函数就会把这些处理成format参数。如果没有输出列表，就会将栈上存储格式化字符串地址解析成在pritnf里面对应的format参数以上图为例，假设调用printf(str)时的栈是这样的。
1）如str就是“hello world”，则直接输出“hello world”；
2）如str是format，比如是%2$x，则输出偏移2处的16进制数据0xdeadbeef。
常用基本的格式化字符串参数介绍：
%c：输出字符，配上%n可用于向指定地址写数据。
%d：输出十进制整数，配上%n可用于向指定地址写数据。
%x：输出16进制数据，如%i$x表示要泄漏偏移i处4字节长的16进制数据，%i$lx表示要泄漏偏移i处8字节长的16进制数据，32bit和64bit环境下一样。
%p：输出16进制数据，与%x基本一样，只是附加了前缀0x，在32bit下输出4字节，在64bit下输出8字节，可通过输出字节的长度来判断目标环境是32bit还是64bit。
%s：输出的内容是字符串，即将偏移处指针指向的字符串输出，如%i$s表示输出偏移i处地址所指向的字符串，在32bit和64bit环境下一样，可用于读取GOT表等信息。
%n：将%n之前printf已经打印的字符个数赋值给偏移处指针所指向的地址位置，如%100×10$n表示将0x64写入偏移10处保存的指针所指向的地址（4字节），而%$hn表示写入的地址空间为2字节，%$hhn表示写入的地址空间为1字节，%$lln表示写入的地址空间为8字节，在32bit和64bit环境下一样。有时，直接写4字节会导致程序崩溃或等候时间过长，可以通过%$hn或%$hhn来适时调整。
%n是通过格式化字符串漏洞改变程序流程的关键方式，而其他格式化字符串参数可用于读取信息或配合%n写数据。


writeup第二条，第五条和第六条

常见的printf有两（及以上）个参数，如printf("%d", &a);。但其实printf只需要一个参数，printf("%d%d");，需要参数时从栈顶依次读入即可。前面的printf("%d", &a);本质上就是先把a的地址压入栈内，然后printf读栈顶元素


%d - 十进制 - 输出十进制整数
%s - 字符串 - 从内存中读取字符串
%x - 十六进制 - 输出十六进制数
%c - 字符 - 输出字符
%p - 指针 - 指针地址
%n - 到目前为止所写的字符数


printf函数的第一个参数就是格式化字符串特别说一下：
%n，如printf("abcdefg%n");,%n前面写了7个字符，所以向ESP（栈顶指针）所指向的地址处（ESP指向了栈顶，此处存储着一个地址）写入7。%10$n，与%n类似，不过是向[ESP + 10]处指向的内存处写入7。